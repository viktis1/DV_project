Total trainable UNET parameters: 859520964
***** Running training *****
  Num examples = 5000
  Num Epochs = 8
  Instantaneous batch size per device = 4
  Total train batch size (w. parallel, distributed & accumulation) = 4
  Gradient Accumulation steps = 1
  Total optimization steps = 10000
Checkpoint 'latest' does not exist. Starting a new training run.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-500
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-1000
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-1500
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-2000
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-2500
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-3000
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-3500
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-4000
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-4500
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-5000
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-5500
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-6000
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-6500
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-7000
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-7500
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-8000
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-8500
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-9000
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.
Removing old UNet checkpoint: simplePrompt_full/unet-steps-9500
Running validation... 
 Generating 4 images with prompt: A chest X-ray image.

------------------------------------------------------------
Sender: LSF System <lsfadmin@hpc.dtu.dk>
Subject: Job 24748531: <SD_finetuning_train> in cluster <dcc> Done

Job <SD_finetuning_train> was submitted from host <hpclogin1> by user <s203957> in cluster <dcc> at Tue Apr 22 08:30:34 2025
Job was executed on host(s) <4*n-62-18-9>, in queue <gpua100>, as user <s203957> in cluster <dcc> at Tue Apr 22 08:36:17 2025
</zhome/a2/d/156154> was used as the home directory.
</zhome/a2/d/156154/project/DV_project> was used as the working directory.
Started at Tue Apr 22 08:36:17 2025
Terminated at Tue Apr 22 09:45:09 2025
Results reported at Tue Apr 22 09:45:09 2025

Your job looked like:

------------------------------------------------------------
# LSBATCH: User input
#!/bin/sh 
### -- specify queue -- 
#BSUB -q gpua100
### -- set the job Name -- 
#BSUB -J SD_finetuning_train
### -- ask for number of cores (default: 1) -- 
#BSUB -n 4
### -- Specify we only want 1 host machine
#BSUB -R "span[hosts=1]"
### -- specify that we need 4GB of memory per core/slot -- 
#BSUB -R "rusage[mem=3GB]"
### -- specify which model to use -- This is unnecessary in this server as we only have 1 model
### -- specify that we want the job to get killed if it exceeds 5 GB per core/slot -- 
#BSUB -M 4GB
### -- set walltime limit: hh:mm -- 
#BSUB -W 4:00
### -- Specify the output and error file. %J is the job-id -- 
### -- -o and -e mean append, -oo and -eo mean overwrite -- 
#BSUB -oo SD_finetuning_train.out 
#BSUB -eo SD_finetuning_train.err 
### Necessary bsub option for GPU
#BSUB -gpu "num=1:mode=exclusive_process"

module load python3/3.11.10
source ~/myenv311/bin/activate

accelerate launch SD_finetuning_train_unet.py \
    --pretrained_model_name_or_path "stable-diffusion-v1-5/stable-diffusion-v1-5" \
    --train_data_dir "/dtu/blackhole/1d/214141/CheXpert-v1.0-small" \
    --mixed_precision "fp16" \
    --validation_prompt "A chest X-ray image" \
    --output_dir "simplePrompt_full" \
    --max_train_steps 10000 \
    --train_batch_size 4 \
    --gradient_accumulation_steps 1 \
    --gradient_checkpointing \
    --resume_from_checkpoint latest \
    --checkpoints_total_limit 1 \
    --lr_scheduler cosine \
    --lr_num_cycles 1
###    --overfit_n 10 \
###    --overfit_repeat 100
###    --threshold_memorization 2

------------------------------------------------------------

Successfully completed.

Resource usage summary:

    CPU time :                                   3440.30 sec.
    Max Memory :                                 5221 MB
    Average Memory :                             2522.20 MB
    Total Requested Memory :                     12288.00 MB
    Delta Memory :                               7067.00 MB
    Max Swap :                                   -
    Max Processes :                              7
    Max Threads :                                31
    Run time :                                   4133 sec.
    Turnaround time :                            4475 sec.

The output (if any) is above this job summary.



PS:

Read file <SD_finetuning_train.err> for stderr output of this job.

